-- Hoogle documentation, generated by Haddock
-- See Hoogle, http://www.haskell.org/hoogle/


-- | yaml loving docker-compose orchestration
--   
--   This is a simple command line tool focused around a dockmaster.yml
--   file for your project, which allows some conveniences such as
--   specifying docker-machine targets and allowing arbitrary hooks around
--   commands that are forwarded to docker-compose.
@package dockmaster
@version 0.1.0.0


module Dockmaster

-- | Runs <tt>docker-compose</tt> commands against resolved composition
--   locations See usage docs for more info. Tries to find a
--   <tt>dockmaster.yml</tt> file based on the initial path argument
dm :: FilePath -> Text -> [Text] -> Sh ()

-- | Dockmaster configuration (specified by dockmaster.yml)
data Dockmaster
Dockmaster :: Maybe ComposeFile -> [Target] -> HashMap Text CommandConfig -> Dockmaster
[dmFile] :: Dockmaster -> Maybe ComposeFile
[dmTargets] :: Dockmaster -> [Target]
[dmCommands] :: Dockmaster -> HashMap Text CommandConfig

-- | Configuration for <tt>docker-compose.yml</tt> file template &amp;
--   vars.
data ComposeFile
ComposeFile :: FilePath -> [FilePath] -> ComposeFile
[cfPath] :: ComposeFile -> FilePath
[cfVars] :: ComposeFile -> [FilePath]

-- | Targets are used to identify where compositions are run.
data Target
Target :: Text -> Text -> Maybe Text -> Target
[targetName] :: Target -> Text
[targetType] :: Target -> Text
[targetMachine] :: Target -> Maybe Text

-- | Hooks can be specified by filename or direct shell command.
data Hook
File :: Text -> Hook
Shell :: Text -> Hook

-- | Configuration for each command.
data CommandConfig
CommandConfig :: Bool -> [Hook] -> [Hook] -> CommandConfig
[ccCompose] :: CommandConfig -> Bool
[ccPreHooks] :: CommandConfig -> [Hook]
[ccPostHooks] :: CommandConfig -> [Hook]

-- | <a>FromJSON</a> instance for <a>ComposeFile</a>

-- | <a>FromJSON</a> instance for <a>Target</a>

-- | <a>FromJSON</a> instance for <a>Hook</a>

-- | <a>FromJSON</a> instance for <a>CommandConfig</a>

-- | <a>FromJSON</a> instance for <a>Dockmaster</a>

-- | Parse <tt>$CWD/dockmaster.yml</tt>
--   
--   Note this assumes we are already in the correct dockmaster workdir.
dockmasterYml :: Sh (Either Text Dockmaster)

-- | Executes specific dc command pre/post hooks around action argument
--   (action arg is typically docker-compose command).
hookWrap :: Text -> Sh () -> Sh ()

-- | Same thing as <a>hookWrap</a> but accepts <a>Dockmaster</a> config to
--   execute against.
hookWrap' :: Dockmaster -> Text -> Sh () -> Sh ()

-- | Runs <tt>docker-compose</tt> but uses compiled
--   <tt>docker-compose.yml</tt> file if template/vars are specified in
--   <tt>dockmaster.yml</tt>.
dockercompose :: Dockmaster -> [Text] -> Sh ()

-- | Dockmaster configuration
data Config
Config :: [FilePath] -> Config
[dmcPaths] :: Config -> [FilePath]

-- | Custom instance to parse strings directly into FilePath TODO ensure
--   this isn't bad. FFP warned me against "orphan instances"...

-- | Instance to parse dockmaster configuration file

-- | Get global dockmaster config
--   
--   If <tt>config.yml</tt> fails to parse, returns a <tt>Left error</tt>.
--   If <tt>config.yml</tt> is not found, returns <tt>Right baseConfig</tt>
--   (default configuration).
config :: Sh (Either Text Config)

-- | Get base config options
baseConfig :: Config

-- | Resolve the appropriate dockmaster workdir.
--   
--   For example, if <tt>$CWD/dockmaster.yml</tt> exists, then
--   
--   <pre>
--   &gt;&gt;&gt; getWorkDir "."
--   Right "."
--   </pre>
--   
--   If <tt>$CWD/dockmaster.yml</tt> does <i>not</i> exist, then
--   
--   <pre>
--   &gt;&gt;&gt; getWorkDir "."
--   Left "dockmaster.yml file not found"
--   </pre>
--   
--   This function will also try to resolve relative paths against the
--   <a>dmcPaths</a> composition listing directories, if any are specified
--   by global config. For example, if:
--   
--   <ol>
--   <li><tt>$HOME/git</tt> is a <tt>PATH</tt> specified in global
--   <tt>config.yml</tt></li>
--   <li><tt>$HOME/git/deploybot/dockmaster.yml</tt> exists</li>
--   <li><tt>$CWD/deploybot/dockmaster.yml</tt> does <i>not</i> exist,
--   then</li>
--   </ol>
--   
--   <pre>
--   &gt;&gt;&gt; getWorkDir "deploybot"
--   Right "$HOME/git/deploybot"
--   </pre>
getWorkDir :: FilePath -> Sh (Either Text FilePath)

-- | Same thing as <a>getWorkDir</a> but uses a <a>Config</a> argument
--   instead of resolving one.
getWorkDir' :: Config -> FilePath -> Sh (Either Text FilePath)
